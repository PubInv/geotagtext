 <!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Draw GeoJSON points</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.css' rel='stylesheet' />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!---added Bootstrap-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- Experimentally trying tesseract -->
    <script src='https://cdn.rawgit.com/naptha/tesseract.js/1.0.10/dist/tesseract.js'></script> 

<!-- <script src="https://cdn.rawgit.com/naptha/tesseract.js/0.2.0/dist/tesseract.js"> -->
</script>

<script>



</script>





    <style>
        /*body { margin:0; padding:0; }
        #map { position:absolute; top:10%; bottom:0; width:100%; }*/

#map
{
    width: 100px;
    height:100px;
    min-height: 100%;
    min-width: 100%;
    display: block;
}

html, body
{
    height: 90%;
}

#map-holder{
    height: 100%;
}

.fill
{
    min-height: 100%;
    height: 100%;
    width: 100%;
    max-width: 100%;
}

.container{
    max-width:60em;
    padding: 0.2em;
}


 


    </style>
</head>
    <body>
    <h1>GeotagText</h1>
    </br>
    <!---
      <div id='inputarea'>    
    Upload a local file to read Exif data.
<input id="file-input-old" type="file" />
    </br>
    <br/>
--->
    
<!---Testing Input for Opening Camera and capturing the picture around the users environment-->
<label class="cameraButton">Take a picture
    <input id="file-input" type="file" accept="image/*;capture=camera">
  </label>

    <button onclick="getLocation()">Try It</button>
    
<div id="demo"> </div>

<!--code ends here-->
    <br/>
	</div>
 

<div class="btn-group-vertical">
  <button type="button" onclick="getLocation()" class="btn btn-primary">Red</button>
  <button type="button"  onclick="getLocation()" class="btn btn-primary">Blue</button>
  <button type="button"  onclick="getLocation()" class="btn btn-primary">Green</button>
</div>







<div id="map-holder">
  <div class="container fill">
    <div id="map"></div>
  </div>
</div>

 
    <!--<-div id='map'>
    </div>-->
    
    
    <script type="text/javascript" src="exif.js"></script>    
    <script>

      var x = document.getElementById("demo");
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else {
      //        x.innerHTML = "Geolocation is not supported by this browser.";
      alert("Geolocation is not supported by this browser.");
    }
}
function showPosition(position) {
    x.innerHTML = "Latitude: " + position.coords.latitude + 
	"<br>Longitude: " + position.coords.longitude;
    var lonDec = position.coords.longitude;
    var latDec = position.coords.latitude;
    var ll = new mapboxgl.LngLat(lonDec, latDec);

    var marker = new mapboxgl.Marker();
      marker.on('click', function() {
    this.setIcon(
        L.mapbox.marker.icon({
            'marker-color': 'red'
        })
    );
});
	.setLngLat(ll);
    
	.addTo(map);

    

}

 




// https://stackoverflow.com/questions/8678371/how-to-convert-gps-degree-to-decimal-and-vice-versa-in-jquery-or-javascript-and
function getDMS2DD(days, minutes, seconds, direction) {
    direction.toUpperCase();
    var dd = days + minutes/60 + seconds/(60*60);
    //alert(dd);
    if (direction == "S" || direction == "W") {
        dd = dd*-1;
    } // Don't do anything for N or E
    return dd;
}


document.getElementById("file-input").onchange = function(e) {
    var file = e.target.files[0]
    if (file && file.name) {
	Tesseract.recognize(file,{
	    lang: 'eng',
	})
		.then(function(result){
		    console.log("Foud this result");
		    console.log(result);
		});
	
        EXIF.getData(file, function() {
	    
	    var exifData = EXIF.pretty(this);
	    if (exifData) {
	    } else {
		alert("No EXIF data found in image '" + file.name + "'.");
		return;
	    }

	    var lat = this.exifdata.GPSLatitude;
	    if (lat) {

		// We probably need to get the direction from exif.
		var latDec = getDMS2DD(lat[0],lat[1],lat[2],this.exifdata.GPSLatitudeRef);

		var lon = this.exifdata.GPSLongitude;

		var lonDec = getDMS2DD(lon[0],lon[1],lon[2],this.exifdata.GPSLongitudeRef);		    

		var ll = new mapboxgl.LngLat(lonDec, latDec);

		var marker = new mapboxgl.Marker()
		    .setLngLat(ll)
		    .addTo(map);
	    } else {
		alert("Unable to extract location data!");
	    }

	
	    
        });
    }
}
  
mapboxgl.accessToken = 'pk.eyJ1Ijoicm9iZXJ0bHJlYWQiLCJhIjoiY2prcHdhbHFnMGpnbDNwbG12ZTFxNnRnOSJ9.1ilsD8zwoacBHbbeP0JLpQ';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v9',
    center: [-96, 37.8],
    zoom: 3
});

map.on('load', function () {

    map.addLayer({
        "id": "points",
        "type": "symbol",
        "source": {
            "type": "geojson",
            "data": {
                "type": "FeatureCollection",
                "features": [{
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-80.5204, 43.46667 ]
                    },
                    "properties": {
                        "title": "Waterloo",
                        "icon": "monument"
                    }
                }, {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-122.414, 37.776]
                    },
                    "properties": {
                        "title": "Mapbox SF",
                        "icon": "harbor"
                    }
                }]
            }
        },
        "layout": {
            "icon-image": "{icon}-15",
            "text-field": "{title}",
            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
            "text-offset": [0, 0.6],
            "text-anchor": "top"
        }
    });
});
</script>

</body>
</html>
